3:I[5613,[],""]
6:I[1778,[],""]
7:I[8383,["250","static/chunks/250-63ba7a57e29c9f6e.js","185","static/chunks/app/layout-ada0ccfdc2732042.js"],""]
4:["category","Android","d"]
5:["slug","day15","d"]
0:["UQ-na9S7VveNwpUsd699O",[[["",{"children":["post",{"children":[["category","Android","d"],{"children":[["slug","day15","d"],{"children":["__PAGE__?{\"category\":\"Android\",\"slug\":\"day15\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["post",{"children":[["category","Android","d"],{"children":[["slug","day15","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children","$5","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"ko","suppressHydrationWarning":true,"children":[["$","head",null,{"children":["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\n              (function() {\n                try {\n                  const savedTheme = localStorage.getItem('theme');\n                  // Default to 'dark' if no save found, ignoring system preference for now to start dark\n                  const theme = savedTheme || 'dark';\n                  document.documentElement.setAttribute('data-theme', theme);\n                } catch (e) {}\n              })();\n            "}}]}],["$","body",null,{"children":["$","div",null,{"className":"app-container","children":[["$","$L7",null,{"categories":["AWS","Android","JAVA"]}],["$","main",null,{"className":"main-content","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}]}]]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/blog/_next/static/css/fff7d7d50ba66cff.css","precedence":"next","crossOrigin":""}]],"$L8"]]]]
9:T169a,<h1>JNI + Frida Native 분석 정리</h1>
<h2>1. Native 라이브러리 메모리 구조</h2>
<h3>실행 시 메모리 배치 개념</h3>
<pre><code>testapp           libtestapp.so           libc.so
0x00000000        0x00123456              0x00234567
</code></pre>
<ul>
<li><strong>base address</strong>
<ul>
<li>앱 또는 라이브러리가 메모리에 적재된 시작 주소</li>
</ul>
</li>
<li><strong>offset</strong>
<ul>
<li>base 주소로부터 함수가 위치한 상대 거리</li>
</ul>
</li>
</ul>
<h3>주소 계산 공식</h3>
<pre><code>실제 함수 주소 = module.base + offset
</code></pre>
<p>예:</p>
<pre><code>base = 0x00100000
offset = 0x000245b0
실제 주소 = 0x001245b0
</code></pre>
<hr>
<h2>2. JNI 함수 예제 (checkPassword)</h2>
<h3>Java 선언부</h3>
<pre><code>public native boolean checkPassword(String pw);
</code></pre>
<h3>Native 함수 시그니처</h3>
<pre><code>Java_kr_seyong_testapp_MainActivity_checkPassword(
    JNIEnv* env,
    jobject thiz,
    jstring pw
)
</code></pre>
<hr>
<h2>3. Ghidra에서 본 Native 코드</h2>
<pre><code>bool Java_kr_seyong_testapp_MainActivity_checkPassword(
    _JNIEnv *env,
    undefined8 thiz,
    _jstring *pw
) {
    int ret;
    char* nativeStr;

    nativeStr = (char*)env->GetStringUTFChars(pw, 0);
    ret = strcmp(nativeStr, "hacker");
    env->ReleaseStringUTFChars(pw, nativeStr);

    return ret == 0;
}
</code></pre>
<h3>핵심 포인트</h3>
<ul>
<li><code>jstring → char*</code> 변환</li>
<li><code>strcmp()</code> 로 문자열 비교</li>
<li><code>"hacker"</code> 와 동일하면 true</li>
</ul>
<hr>
<h2>4. JNI 분석 순서 정리</h2>
<ol>
<li>Java에서 <strong>native 함수 선언부 확인</strong></li>
<li><code>System.loadLibrary()</code> 또는 <code>System.load()</code> 확인</li>
<li>실제 <code>.so</code> 파일 위치 확인
<ul>
<li><code>/lib/&#x3C;abi>/libxxx.so</code></li>
<li><code>/android/obb/</code></li>
</ul>
</li>
<li>현재 실행 환경에 맞는 ABI 선택</li>
<li><code>.so</code> 파일 추출</li>
<li>Ghidra로 열기</li>
<li>Export 함수 목록 확인</li>
<li>분석 대상 함수 확인</li>
</ol>
<hr>
<h2>5. Frida에서 Native 제어 개념</h2>
<h3>Java vs Native 제어 방식</h3>
<p>| 구분      | Java           | Native        |
| --------- | -------------- | ------------- |
| 접근 방식 | Java.use       | NativePointer |
| 기준      | 클래스/메소드  | 메모리 주소   |
| 후킹      | implementation | Interceptor   |</p>
<hr>
<h2>6. Native 함수 주소 찾기</h2>
<h3>Export 기반</h3>
<pre><code>var lib = Process.findModuleByName("libtestapp.so");
var func = lib.findExportByName(
  "Java_kr_seyong_testapp_MainActivity_checkPassword"
);
</code></pre>
<h3>Offset 기반</h3>
<pre><code>var base = lib.base;
var func = base.add(0x245b0);
</code></pre>
<hr>
<h2>7. Native 함수 후킹 (Interceptor.attach)</h2>
<pre><code>Interceptor.attach(func, {
    onEnter: function (args) {
        console.log("checkPassword 호출");

        // args[2] = jstring pw
    },
    onLeave: function (ret) {
        console.log("리턴값:", ret);
    }
});
</code></pre>
<h3>인자 구조</h3>
<pre><code>args[0] → JNIEnv*
args[1] → jobject (this)
args[2] → jstring pw
</code></pre>
<hr>
<h2>8. 인자 값 변조 (메모리 조작)</h2>
<pre><code>Interceptor.attach(func, {
    onEnter: function (args) {
        var newStr = Memory.allocUtf8String("hackernono");
        args[2] = newStr;
    }
});
</code></pre>
<ul>
<li>Native 영역은 <strong>메모리 직접 수정</strong></li>
<li>문자열 끝에 <code>\0</code> 필요</li>
</ul>
<hr>
<h2>9. 리턴값 변조</h2>
<pre><code>Interceptor.attach(func, {
    onLeave: function (ret) {
        ret.replace(0x01); // true
    }
});
</code></pre>
<ul>
<li>인증 로직 강제 통과 가능</li>
</ul>
<hr>
<h2>10. 함수 완전 교체 (Interceptor.replace)</h2>
<pre><code>var newFunc = new NativeCallback(function () {
    return 1;
}, 'int', []);

Interceptor.replace(func, newFunc);
</code></pre>
<ul>
<li>원래 함수 실행 자체를 제거</li>
</ul>
<hr>
<h2>11. Native 함수 직접 호출</h2>
<pre><code>var nativeFunc = new NativeFunction(
    func,
    'int',
    ['pointer', 'pointer', 'pointer']
);

var result = nativeFunc(a, b, c);
console.log(result);
</code></pre>
<hr>
<h2>12. strcmp 후킹 개념</h2>
<pre><code>var strcmpPtr = ptr("0x79cbc06e4010");
</code></pre>
<p>주의:</p>
<ul>
<li>문자열 <code>"0x79cbc06e4010"</code> → 잘못된 타입</li>
<li>반드시 <code>ptr()</code> 또는 <code>NativePointer</code> 사용</li>
</ul>
<hr>
<h2>13. 모듈 / 함수 탐색</h2>
<pre><code>Process.enumerateModules();
Module.enumerateExports();
Module.enumerateImports();
</code></pre>
<hr>
<h2>14. JNI 문자열 처리 예제 (정상 구현)</h2>
<pre><code>const char* jstringToCString(JNIEnv* env, jstring jstr) {
    if (jstr == NULL) return NULL;
    return env->GetStringUTFChars(jstr, NULL);
}
jboolean checkPasswordNative(const char* pw) {
    if (pw == NULL) return JNI_FALSE;
    return strcmp(pw, "hacker") == 0;
}
</code></pre>
<hr>
<h2>15. Frida 개발 환경 팁</h2>
<ul>
<li>Frida JS 자동완성
<ul>
<li>Node.js 설치 필요</li>
</ul>
</li>
<li>VSCode
<ul>
<li>Extension: <strong>Frida Workbench</strong></li>
<li>명령 팔레트 → <code>Frida: Enable Hints</code></li>
</ul>
</li>
</ul>
<hr>
<h2>16. 핵심 정리</h2>
<ul>
<li>JNI 분석은 <strong>주소 기반 사고</strong></li>
<li>offset 개념 필수</li>
<li>Java 문자열 ≠ C 문자열</li>
<li>Native 후킹은 <code>Interceptor</code></li>
<li>인증/무결성 로직은 Native에 숨겨지는 경우가 많음</li>
<li>Ghidra + Frida 조합이 가장 강력</li>
</ul>
2:["$","article",null,{"className":"article-container","children":[["$","div",null,{"className":"article-header","children":[["$","span",null,{"className":"article-category","children":"Android"}],["$","h1",null,{"className":"article-title","children":"Android 보안 15일차"}]]}],["$","div",null,{"className":"article-content","dangerouslySetInnerHTML":{"__html":"$9"}}]]}]
8:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"jinwk note"}],["$","meta","3",{"name":"description","content":"jinwk dev note"}]]
1:null
