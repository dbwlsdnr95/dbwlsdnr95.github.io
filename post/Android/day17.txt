3:I[5613,[],""]
6:I[1778,[],""]
7:I[8383,["250","static/chunks/250-069982e43c2ae463.js","185","static/chunks/app/layout-10c7e025b6149e17.js"],""]
8:I[5250,["250","static/chunks/250-069982e43c2ae463.js","931","static/chunks/app/page-e31ae51de7be232e.js"],""]
4:["category","Android","d"]
5:["slug","day17","d"]
0:["TRFLD1MljlsxO-bl3YPbV",[[["",{"children":["post",{"children":[["category","Android","d"],{"children":[["slug","day17","d"],{"children":["__PAGE__?{\"category\":\"Android\",\"slug\":\"day17\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["post",{"children":[["category","Android","d"],{"children":[["slug","day17","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children","$5","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"ko","suppressHydrationWarning":true,"children":[["$","head",null,{"children":["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\n              (function() {\n                try {\n                  const savedTheme = localStorage.getItem('theme');\n                  // Default to 'dark' if no save found, ignoring system preference for now to start dark\n                  const theme = savedTheme || 'dark';\n                  document.documentElement.setAttribute('data-theme', theme);\n                } catch (e) {}\n              })();\n            "}}]}],["$","body",null,{"children":["$","div",null,{"className":"app-container","children":[["$","$L7",null,{"categories":["AWS","Android","JAVA"]}],["$","main",null,{"className":"main-content","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"className":"flex flex-col items-center justify-center min-h-[60vh] text-center px-4","children":[["$","h2",null,{"className":"text-4xl font-bold mb-4","children":"404 - Not Found"}],["$","p",null,{"className":"text-gray-500 mb-8","children":"요청하신 페이지를 찾을 수 없습니다."}],["$","$L8",null,{"href":"/","className":"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition","children":"홈으로 돌아가기"}]]}],"notFoundStyles":[],"styles":null}]}]]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/fff7d7d50ba66cff.css","precedence":"next","crossOrigin":""}]],"$L9"]]]]
a:T132a,<h1>EQST LMS Wargame – JNI 분석 정리</h1>
<h2>1. Frida 버전 이슈</h2>
<h3>Export 함수 찾기 변화</h3>
<ul>
<li>예전 방식 (동작 X)</li>
</ul>
<pre><code>Module.findExportByName(null, "함수명");
</code></pre>
<ul>
<li>현재 Frida 권장 방식</li>
</ul>
<pre><code>Module.findGlobalExportByName("함수명");
</code></pre>
<h3>버전 호환성</h3>
<ul>
<li>최신 Frida에서 일부 Wargame 동작 문제 발생</li>
<li><strong>Frida 17 → 14로 다운그레이드 후 정상 동작</strong></li>
</ul>
<hr>
<h2>2. C / Java boolean 차이</h2>
<h3>C / C++</h3>
<ul>
<li><code>bool</code>
<ul>
<li><code>0</code> : false</li>
<li><code>1</code> : true</li>
</ul>
</li>
<li>내부적으로 <code>int</code></li>
</ul>
<h3>Java / JNI</h3>
<ul>
<li><code>boolean</code>, <code>jboolean</code></li>
<li>JNI 시그니처에서는 <code>undefined8</code> 등으로 보일 수 있음</li>
</ul>
<h3>JNI 함수 시그니처 예시</h3>
<pre><code>bool Java_kr_co_eqst_aos_app039_MainActivity_koalavsmonkey(JNIEnv* env, jobject thiz)
</code></pre>
<hr>
<h2>3. JNI 함수 호출 구조</h2>
<ul>
<li>Java Activity에서 Native 함수 호출</li>
<li>JNI 함수는 항상 다음 인자를 가짐</li>
</ul>
<pre><code>JNIEnv*
jobject (this)
[추가 인자들]
</code></pre>
<hr>
<h2>4. 3번 문제 – strcmp 리턴값 변조</h2>
<h3>핵심 아이디어</h3>
<ul>
<li><code>strcmp()</code> 결과를 조작해 조건을 항상 참으로 만들기</li>
<li><code>"eqst"</code> 와 비교되는 경우만 타겟팅</li>
</ul>
<h3>Frida 코드</h3>
<pre><code>var strcmpPtr = Module.findGlobalExportByName("strcmp");
var inja2;

Interceptor.attach(strcmpPtr, {
    onEnter: function (args) {
        inja2 = args[1].readCString();
        if (inja2 == "eqst") {
            console.log("비교 대상:", args[0].readCString());
            console.log("strcmp 호출됨");
        }
    },
    onLeave: function (re) {
        if (inja2 == "eqst") {
            console.log("결과를 참으로 변조");
            re.replace(0x0); // strcmp == 0 → 동일
        }
    }
});
</code></pre>
<hr>
<h2>5. Spawn 모드 주의사항</h2>
<pre><code>frida -U -f 패키지명
</code></pre>
<ul>
<li>Spawn 상태에서는 Native 모듈이 아직 로드되지 않아
<ul>
<li><code>Process.findModuleByName()</code> 실패 가능</li>
</ul>
</li>
<li>해결 방법
<ul>
<li><code>System.loadLibrary</code> 이후 후킹</li>
<li><code>onCreate</code> 후킹</li>
<li>일정 시간 delay 후 실행</li>
</ul>
</li>
</ul>
<hr>
<h2>6. Native 함수 Offset 기반 후킹</h2>
<h3>메모리 구조</h3>
<pre><code>libnative-lib.so
base = 0x00100000
함수 = 0x00101930
offset = 0x1930
</code></pre>
<h3>Frida 코드</h3>
<pre><code>var libMod = Process.findModuleByName("libnative-lib.so");
console.log("native-lib base:", libMod.base);

var funcPtr = libMod.base.add(0x1930);
console.log("LMS 문자열 리턴 함수:", funcPtr);

Interceptor.attach(funcPtr, {
    onLeave: function (ret) {
        var newPtr = Memory.allocUtf8String("eqst");
        ret.replace(newPtr);
    }
});
</code></pre>
<hr>
<h2>7. strcmp 모니터링용 후킹 (확인용)</h2>
<pre><code>var strcmpPtr = Module.findGlobalExportByName("strcmp");
var inja2;

Interceptor.attach(strcmpPtr, {
    onEnter: function (args) {
        inja2 = args[1].readCString();
        if (inja2 == "eqst") {
            console.log("비교 문자열:", args[0].readUtf8String());
            console.log("strcmp 호출됨");
        }
    }
});
</code></pre>
<hr>
<h2>8. Native 함수 직접 호출 (Flag 추출)</h2>
<h3>목표</h3>
<ul>
<li>Native 함수가 반환하는 <code>jstring</code> 직접 호출하여 Flag 획득</li>
</ul>
<h3>Frida 코드</h3>
<pre><code>Java.perform(function () {

    const soName = "libnative-lib.so";
    const module = Process.getModuleByName(soName);
    const realflagPtr = module.base.add(0x1070);

    console.log("[+] realflag 주소:", realflagPtr);

    const realflag = new NativeFunction(
        realflagPtr,
        "pointer",              // jstring
        ["pointer", "pointer"]  // JNIEnv*, jclass
    );

    const env = Java.vm.getEnv();
    const clazz = ptr(0);

    const jstr = realflag(env.handle, clazz);
    console.log("[+] jstring:", jstr);

    const result = env.getStringUtfChars(jstr).readCString();
    console.log("[+] result:", result);
});
</code></pre>
<hr>
<h2>9. 핵심 개념 요약</h2>
<ul>
<li><code>Module.findGlobalExportByName</code> 사용</li>
<li><code>strcmp == 0</code> → 문자열 동일</li>
<li>Native 함수는 <strong>base + offset</strong> 사고</li>
<li>Spawn 모드에서는 Native 로딩 타이밍 중요</li>
<li><code>jstring</code>은 반드시 <code>JNIEnv</code>를 통해 문자열로 변환</li>
<li>attach = 감시 + 변조</li>
<li>replace = 완전 치환</li>
</ul>
2:["$","article",null,{"className":"article-container","children":[["$","div",null,{"className":"article-header","children":[["$","span",null,{"className":"article-category","children":"Android"}],["$","h1",null,{"className":"article-title","children":"Android 보안 17일차"}]]}],["$","div",null,{"className":"article-content","dangerouslySetInnerHTML":{"__html":"$a"}}]]}]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"jinwk note"}],["$","meta","3",{"name":"description","content":"jinwk dev note"}]]
1:null
