3:I[5613,[],""]
6:I[1778,[],""]
7:I[8383,["250","static/chunks/250-069982e43c2ae463.js","185","static/chunks/app/layout-ada0ccfdc2732042.js"],""]
4:["category","Android","d"]
5:["slug","day16","d"]
0:["Abs63gimMocH9GC6KfM8u",[[["",{"children":["post",{"children":[["category","Android","d"],{"children":[["slug","day16","d"],{"children":["__PAGE__?{\"category\":\"Android\",\"slug\":\"day16\"}",{}]}]}]}]},"$undefined","$undefined",true],["",{"children":["post",{"children":[["category","Android","d"],{"children":[["slug","day16","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children","$5","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","post","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"ko","suppressHydrationWarning":true,"children":[["$","head",null,{"children":["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\n              (function() {\n                try {\n                  const savedTheme = localStorage.getItem('theme');\n                  // Default to 'dark' if no save found, ignoring system preference for now to start dark\n                  const theme = savedTheme || 'dark';\n                  document.documentElement.setAttribute('data-theme', theme);\n                } catch (e) {}\n              })();\n            "}}]}],["$","body",null,{"children":["$","div",null,{"className":"app-container","children":[["$","$L7",null,{"categories":["AWS","Android","JAVA"]}],["$","main",null,{"className":"main-content","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}]}]]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/fff7d7d50ba66cff.css","precedence":"next","crossOrigin":""}]],"$L8"]]]]
9:T1a91,<h1>JNI (Java Native Interface) 정리</h1>
<h2>1. JNI 개념</h2>
<h3>JNI란?</h3>
<ul>
<li><strong>Java/Kotlin ↔ C/C++</strong> 를 연결하는 인터페이스</li>
<li>Android 앱에서 Native 코드(<code>.so</code>)를 사용하기 위한 표준 방식</li>
</ul>
<h3>JNI를 사용하는 이유</h3>
<ul>
<li><strong>성능</strong>
<ul>
<li>VM 위가 아닌 Native에서 직접 연산</li>
<li>게임, 그래픽, 대규모 연산</li>
</ul>
</li>
<li><strong>기존 라이브러리 활용</strong>
<ul>
<li>이미 만들어진 C/C++ 라이브러리 재사용</li>
</ul>
</li>
<li><strong>메모리 직접 제어</strong>
<ul>
<li>GC 영향 없이 직접 관리</li>
</ul>
</li>
<li><strong>보안</strong>
<ul>
<li>Java 코드보다 리버싱 난이도 상승</li>
<li>금융 앱, 게임, 보안 솔루션에서 다수 사용</li>
</ul>
</li>
</ul>
<hr>
<h2>2. Java / Native 실행 구조 비교</h2>
<h3>Java / Kotlin</h3>
<ul>
<li>JVM 위에서 실행</li>
<li>Cross-platform</li>
<li>코드 하나로 모든 기기에서 실행 가능</li>
</ul>
<h3>Native (C/C++)</h3>
<ul>
<li>OS / 아키텍처 의존</li>
<li>환경별로 빌드 필요</li>
</ul>
<p>| 환경    | 결과           |
| ------- | -------------- |
| Windows | <code>.exe</code>, <code>.dll</code> |
| Linux   | ELF, <code>.so</code>     |
| Android | <code>.so</code> (ABI별)  |</p>
<hr>
<h2>3. JNI 함수 연결 방식</h2>
<h3>Java 쪽</h3>
<pre><code>public native boolean checkPassword(String pw);
</code></pre>
<h3>Native 쪽 (기본 네이밍)</h3>
<pre><code>Java_패키지명_클래스명_함수명
</code></pre>
<p>예:</p>
<pre><code>Java_kr_seyong_test_MainActivity_checkPassword
</code></pre>
<h3>System.load / loadLibrary</h3>
<pre><code>System.loadLibrary("test");   // libtest.so
System.load("/sdcard/.../libtest.so");
</code></pre>
<ul>
<li>라이브러리 로딩 시 <code>JNI_OnLoad</code> 실행 가능</li>
</ul>
<hr>
<h2>4. RegisterNative 방식</h2>
<ul>
<li>함수 이름을 직접 매핑</li>
<li>Java 함수명 ≠ Native 함수명 가능</li>
</ul>
<pre><code>JNI_OnLoad() {
    RegisterNativeMethods(
        Java test() → C qqqq()
    );
}
</code></pre>
<ul>
<li>Ghidra에서 함수명이 난독화되어 보이는 이유</li>
</ul>
<hr>
<h2>5. Android / iOS 리버싱 구조 비교</h2>
<h3>Android</h3>
<ul>
<li>APK = ZIP</li>
<li><code>classes.dex → smali → java (jadx)</code></li>
<li>Native: <code>.so</code> → Ghidra / IDA</li>
</ul>
<h3>iOS</h3>
<ul>
<li>IPA = ZIP</li>
<li><code>Info.plist</code></li>
<li>Binary 추출 후 Ghidra / IDA</li>
<li>탈옥 환경: Cydia, Zebra, Sileo</li>
<li>설치: appinst, 3uTools, appsync</li>
</ul>
<hr>
<h2>6. Native 메모리 구조와 Offset</h2>
<h3>메모리 배치 개념</h3>
<pre><code>libc.so        libandroid.so        libtest.so
[            ][                  ][            ]
base                            base
</code></pre>
<h3>Offset 개념</h3>
<ul>
<li>base 주소로부터 떨어진 거리</li>
</ul>
<pre><code>실제 함수 주소 = module.base + offset
</code></pre>
<p>예:</p>
<pre><code>base   = 0x00100000
offset = 0x000243c0
addr   = 0x001243c0
</code></pre>
<hr>
<h2>7. JNI Native 코드 예제 (Ghidra 기준)</h2>
<pre><code>bool Java_kr_seyong_test_MainActivity_checkPassword(
    JNIEnv *env,
    jobject thiz,
    jstring pw
) {
    int ret;
    char* nativeStr;

    nativeStr = env->GetStringUTFChars(pw, 0);
    ret = strcmp(nativeStr, "hacker");
    env->ReleaseStringUTFChars(pw, nativeStr);

    return ret == 0;
}
</code></pre>
<h3>핵심</h3>
<ul>
<li><code>jstring → char*</code></li>
<li><code>strcmp</code> 결과로 인증 판단</li>
</ul>
<hr>
<h2>8. Frida Native 후킹 기본 구조</h2>
<h3>라이브러리 &#x26; 함수 주소 찾기</h3>
<pre><code>var lib = Process.findModuleByName("libtest.so");

// 1. 함수명 기반
var funcAddr = lib.findExportByName(
  "Java_kr_seyong_test_MainActivity_checkPassword"
);

// 2. 오프셋 기반
var funcAddr = lib.base.add(0x243c0);
</code></pre>
<hr>
<h2>9. Interceptor.attach (함수 후킹)</h2>
<h3>실행 흐름</h3>
<ul>
<li><strong>onEnter</strong>: 함수 진입 시</li>
<li><strong>onLeave</strong>: 리턴 직전</li>
</ul>
<pre><code>Interceptor.attach(funcAddr, {
    onEnter: function (args) {
        /*
          args[0] = JNIEnv*
          args[1] = jobject (this)
          args[2] = jstring (pw)
        */
    },
    onLeave: function (retval) {
    }
});
</code></pre>
<hr>
<h2>10. jstring 값 읽기</h2>
<pre><code>var env = Java.vm.getEnv();
var pw = env.getStringUtfChars(args[2], null).readCString();
console.log(pw);
</code></pre>
<hr>
<h2>11. 리턴값 변조 (인증 우회)</h2>
<pre><code>onLeave: function (retval) {
    retval.replace(1); // JNI_TRUE
}
</code></pre>
<hr>
<h2>12. strcmp 전역 후킹</h2>
<pre><code>var strcmpAddr = Module.findGlobalExportByName("strcmp");

Interceptor.attach(strcmpAddr, {
    onEnter: function (args) {
        var a = args[0].readCString();
        var b = args[1].readCString();
    },
    onLeave: function (retval) {
        retval.replace(0);
    }
});
</code></pre>
<hr>
<h2>13. Native 함수 직접 호출</h2>
<pre><code>var nativeFunc = new NativeFunction(
    funcAddr,
    "int",
    ["pointer", "pointer", "pointer"]
);

var ret = nativeFunc(a, b, c);
</code></pre>
<hr>
<h2>14. 함수 완전 교체 (Interceptor.replace)</h2>
<pre><code>var newFunc = new NativeCallback(function () {
    return 1;
}, "int", []);

Interceptor.replace(funcAddr, newFunc);
</code></pre>
<ul>
<li>원본 함수 실행 자체 제거</li>
</ul>
<hr>
<h2>15. Java 후킹과 비교</h2>
<h3>Java</h3>
<pre><code>Java.use("Class").method.implementation = function () {
    return true;
};
</code></pre>
<h3>Native</h3>
<ul>
<li>주소 기반</li>
<li>메모리 직접 제어</li>
</ul>
<hr>
<h2>16. Hook 타이밍 이슈</h2>
<h3>문제</h3>
<ul>
<li><code>-f 패키지명</code> 실행 시
<ul>
<li><code>System.loadLibrary</code> 미실행</li>
<li>lib 주소가 null</li>
</ul>
</li>
</ul>
<h3>해결 방법</h3>
<ul>
<li><code>System.loadLibrary</code> 후킹</li>
<li><code>onCreate</code> 후킹</li>
<li>일정 시간 지연 후 후킹</li>
</ul>
<hr>
<h2>17. 조건 분기 (어셈블리 개념)</h2>
<pre><code>CMP v0, v1
JZ  0x1234   ; 같으면 점프
JNZ 0x1234   ; 다르면 점프
</code></pre>
<p>Java 코드 대응:</p>
<pre><code>if (a == b) {
    // 참
}
</code></pre>
<hr>
<h2>18. 핵심 정리</h2>
<ul>
<li>JNI 분석은 <strong>주소 + 오프셋 사고</strong></li>
<li>Java String ≠ C String</li>
<li>인증/무결성 로직은 Native에 숨겨지는 경우 많음</li>
<li>Ghidra + Frida 조합이 가장 강력</li>
<li>attach = 감시</li>
<li>replace = 완전 대체</li>
</ul>
2:["$","article",null,{"className":"article-container","children":[["$","div",null,{"className":"article-header","children":[["$","span",null,{"className":"article-category","children":"Android"}],["$","h1",null,{"className":"article-title","children":"Android 보안 16일차"}]]}],["$","div",null,{"className":"article-content","dangerouslySetInnerHTML":{"__html":"$9"}}]]}]
8:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"jinwk note"}],["$","meta","3",{"name":"description","content":"jinwk dev note"}]]
1:null
